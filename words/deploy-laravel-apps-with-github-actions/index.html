<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="referrer" content="always">
    <link rel="canonical" href="https://imacrayon.com/words/deploy-laravel-apps-with-github-actions">

    <title>Deploy Laravel Apps with Github Actions | I&#039;m a crayon</title>
    <meta name="description" content="How I deploy Laravel Apps using Github Actions">

    <link rel="icon" href="/favicon.svg">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#AA8C2C">

    <meta property="og:title" content="Deploy Laravel Apps with Github Actions | I&#039;m a crayon"/>
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://imacrayon.com/words/deploy-laravel-apps-with-github-actions"/>
    <meta property="og:description" content="Work by Christian Taylor. An artist &amp; full stack developer based in Wichita, KS." />

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@ima_crayon">
    <meta name="twitter:creator" content="@ima_crayon">

    
    <link href="https://twitter.com/ima_crayon" rel="me">

    
    <link rel="webmention" href="https://webmention.io/imacrayon.com/webmention" />
    <link rel="pingback" href="https://webmention.io/imacrayon.com/xmlrpc" />

    <link href="/feed.atom" type="application/atom+xml" rel="alternate" title="I&#039;m a crayon Atom Feed">

    <link rel="stylesheet" href="/assets/css/main.css?id=04e600291c4a9453082a11c3f2e48b4b">

    <script src="/assets/js/webmention.js" data-page-url="https://imacrayon.com/pictures/" async></script>
  </head>
  <body class="text-gray-700 font-sans antialiased">
    <header role="banner" class="mt-12">
      <div class="mx-auto px-4 max-w-2xl">
        <a class="sr-only block bg-black text-white text-lg text-center font-medium focus:not-sr-only" href="#main">
          <span class="block p-4">Skip to content</span>
        </a>
        <div class="flex items-center text-sm">
          <a class="text-gray-500 hover:bg-gold-100 hover:text-gold-800" href="/" title="I&#039;m a crayon home">
            I'm a crayon
          </a>
          <div class="flex flex-1 justify-end items-center">
             <nav class="flex items-center justify-end space-x-6">
   <a class="inline-flex items-center hover:bg-gold-100 hover:text-gold-800" href="/pictures">
  Pictures
</a>
 
   <a class="inline-flex items-center hover:bg-gold-100 hover:text-gold-800" href="/about">
  About
</a>
 
</nav>
 
          </div>
        </div>
      </div>
    </header>
    <main id="main">
      <div class="pt-12">
  <article class="mx-auto px-4 max-w-2xl">
    <div class="space-y-2">
      <h1 class="text-2xl sm:text-3xl font-medium break-words">Deploy Laravel Apps with Github Actions</h1>
      <div class="grid sm:grid-cols-2 gap-1">
        <div>
           <time class="block text-gray-500 text-xs uppercase tracking-widest" datetime="2020-06-06T20:26:00+00:00">
  June 6, 2020
</time>
 
        </div>
                  <div class="text-xs uppercase tracking-widest flex justify-end">
            <div>
                              <a href="/words/categories/php" class="hover:text-gold-800 focus:text-gold-800 hover:bg-gold-100 focus:bg-gold-100">php</a>,                               <a href="/words/categories/laravel" class="hover:text-gold-800 focus:text-gold-800 hover:bg-gold-100 focus:bg-gold-100">laravel</a>,                               <a href="/words/categories/tooling" class="hover:text-gold-800 focus:text-gold-800 hover:bg-gold-100 focus:bg-gold-100">tooling</a>                          </div>
          </div>
              </div>
    </div>

    <div class="mt-10 prose max-w-full">
      <p>I deployed my first Laravel project using <a href="https://github.com/features/actions">Github Actions</a> today, these articles and resources were a big help in doing so:</p>

<ul>
<li><a href="https://medium.com/@driesvints/building-and-deploying-laravel-with-github-actions-8111e8a6646e">Building and Deploying Laravel with Github Actions</a> by Dries Vints</li>
<li><a href="https://freek.dev/1546-using-github-actions-to-run-the-tests-of-laravel-projects-and-packages">Using GitHub actions to run the tests of Laravel projects and packages</a></li>
<li><a href="https://github.com/actions/starter-workflows/blob/2ffdd0654ef8d0dfa8ff3c740a6f1d4c2eaccd8f/ci/laravel.yml">GitHub Actions Laravel Starter Workflow</a></li>
</ul>

<p>Here's the workflow config I landed on:</p>

<pre><code>name: Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Cache dependencies
        uses: actions/cache@v2
        with:
          path: ~/.composer/cache/files
          key: dependencies-composer-${{ hashFiles('composer.lock') }}

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 7.4
          extensions: dom, curl, libxml, mbstring, zip, pcntl, pdo, sqlite, pdo_sqlite
          coverage: none

      - name: Install Composer dependencies
        run: composer install --prefer-dist --no-interaction

      - name: Execute tests
        run: vendor/bin/phpunit --verbose

      - name: Send Slack notification
        uses: 8398a7/action-slack@v2
        if: failure()
        with:
          status: ${{ job.status }}
          author_name: ${{ github.actor }}
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Deploy to Envoyer
        if: github.ref == 'refs/heads/main'
        run: curl ${{ secrets.ENVOYER_HOOK }}?sha=${{ github.sha }}
</code></pre>

<p>Here's a summary of the steps and some required configuration:</p>

<ul>
<li><code>Checkout code</code> checks out the fresh code.</li>
<li><code>Cache dependencies</code> will cache composer downloads so that future actions run quicker. The cache is busted when your <code>composer.lock</code> file changes.</li>
<li><code>Setup PHP</code> will setup PHP 7.4 as well as Laravel's required extensions.</li>
<li><code>Execute tests</code> runs PHPUnit.</li>
<li><code>Send Slack notification</code> will send a notification to the specified webhook if any tests fail.</li>
<li><code>Deploy to Envoyer</code> triggers a new Envoyer deployment when new code is pushed to the <code>main</code> branch.</li>
</ul>

<p>In order for PHPUnit to work your Laravel app must have an <code>APP_KEY</code> set. The easiest way to do this is to modify the <code>phpunit.xml</code> file in your project and hardcode an app key:</p>

<pre><code>&lt;phpunit&gt;
    &lt;php&gt;
        ...

        &lt;server name="APP_KEY" value="base64:NXoQgjw2ZlOxnGbo5ZRhYgTdM6xLYsgYElNAgcTQJkE="/&gt;

        ...
</code></pre>

<p>The last thing you'll need to do is setup two secrets under your repo's "Secrets" settings page on GitHub. Note that the <code>GITHUB_TOKEN</code> secret in our action is automatically provided for you.</p>

<ul>
<li>Create a <code>SLACK_WEBHOOK</code> secret to store your Slack webhook URL.</li>
<li>Create a <code>ENVOYER_HOOK</code> secret to store the deployment URL for your Envoyer project.</li>
</ul>
    </div>

    <nav class="my-12 border-t border-gray-200 grid sm:grid-cols-2 sm:border-0 sm:gap-8">
              <a class="group border-b border-gray-200 flex hover:bg-gold-50 hover:text-gold-800" href="https://imacrayon.com/words/the-power-of-assertSessionHasNoErrors" title="Older Post: Make Laravel Tests Easier To Debug With `assertSessionHasNoErrors`">
          <span class="flex-shrink-0 flex items-center group-hover:bg-gold-100">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" class="h-6 w-6 text-gray-400 group-hover:text-gold-400" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </span>
          <span class="flex-1 py-3 px-6 flex items-center justify-end text-right">
            <span class="space-y-1">
              <span class="font-medium">Make Laravel Tests Easier To Debug With `assertSessionHasNoErrors`</span>
               <time class="block text-gray-500 text-xs uppercase tracking-widest" datetime="2020-04-26T20:55:00+00:00">
  April 26, 2020
</time>
 
            </span>
          </span>
        </a>
                    <a class="group border-b border-gray-200 flex hover:bg-gold-50 hover:text-gold-800" href="https://imacrayon.com/words/2020-recap" title="Newer Post: 2020 Recap">
          <span class="flex-1 py-3 px-6 flex items-center">
            <span class="space-y-1">
              <span class="font-medium">2020 Recap</span>
               <time class="block text-gray-500 text-xs uppercase tracking-widest" datetime="2020-12-31T13:41:00+00:00">
  December 31, 2020
</time>
 
            </span>
          </span>
          <span class="flex-shrink-0 flex items-center group-hover:bg-gold-100">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" class="h-6 w-6 text-gray-400 group-hover:text-gold-400" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </span>
        </a>
          </nav>

    <div id="mentions" class="space-y-8 mb-12">
      <h2 class="text-2xl sm:text-3xl font-medium">Mentions</h2>
              <p class="italic text-gray-500">Nothing.</p>
          </div>
  </article>
</div>
    </main>
    <footer class="mb-12 text-sm flex justify-center">
       <nav class="flex items-center justify-end space-x-6">
   <a class="inline-flex items-center hover:bg-gold-100 hover:text-gold-800" href="/pictures">
  Pictures
</a>
 
   <a class="inline-flex items-center hover:bg-gold-100 hover:text-gold-800" href="/about">
  About
</a>
 
</nav>
 
    </footer>
  </body>
</html>
