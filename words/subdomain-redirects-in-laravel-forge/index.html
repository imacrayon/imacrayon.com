<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subdomain Redirects in Laravel Forge</title>
  <meta name="description" content="How to redirect a subdomain to another domain in Laravel Forge.">
  <meta name="generator" content="Eleventy v2.0.0">
  <link rel="icon" href="/img/favicon.svg">

  <meta property="og:type" content="website">
  <meta property="og:title" content="Subdomain Redirects in Laravel Forge">
  <meta property="og:description" content="How to redirect a subdomain to another domain in Laravel Forge.">
  <meta property="og:url" content="/words/subdomain-redirects-in-laravel-forge/">
  <meta property="og:locale">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@ima_crayon">
  <meta name="twitter:creator" content="@ima_crayon">

  <link rel="me" href="https://twitter.com/ima_crayon">
  <link rel="webmention" href="https://webmention.io/imacrayon.com/webmention">
  <link rel="pingback" href="https://webmention.io/imacrayon.com/xmlrpc">

  <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="I'm a crayon">
  <link rel="alternate" href="/feed/feed.json" type="application/json" title="I'm a crayon">

  <link rel="stylesheet" href="/css/main.css?id=-1328759834">

  
  <style>/**
 * Gruvbox dark theme
 *
 * Adapted from a theme based on:
 * Vim Gruvbox dark Theme (https://github.com/morhetz/gruvbox)
 *
 * @author Azat S. <to@azat.io>
 * @version 1.0
 */

:root {
  /* Changed from #1d2021 for accessible contrast */
  --code-fg: #ebdbb2;
  --code-fg4: #a89984;
  --code-bg: #1C1C1C;
  --code-highlight: rgba(104, 157, 106, 0.5);
  --code-gray: #928374;
  --code-green: #b8bb26;
  --code-red: #fb4934;
  --code-aqua: #8ec07c;
  --code-yellow: #fabd2f;
  --code-orange: #fe8019;
  --code-blue: #83a598;
  --code-purple: #d3869b;
}

code,
pre {
  color: var(--code-fg);
  direction: ltr;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  line-height: 2;

  -moz-tab-size: 2;
  -o-tab-size: 2;
  tab-size: 2;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

pre::-moz-selection,
pre ::-moz-selection,
code::-moz-selection,
code ::-moz-selection {
  background: var(--code-highlight);
}

pre::selection,
pre ::selection,
code::selection,
code ::selection {
  background: var(--code-highlight);
}

code,
pre {
  background: var(--code-bg);
}

:not(pre)>code {
  padding: 0.1em 0.414em;
}

.token.comment,
.token.prolog,
.token.cdata {
  color: var(--code-gray);
}

/* @media (max-width: 768px) { */

.token.delimiter,
.token.boolean,
.token.keyword,
.token.important {
  color: var(--code-red);
}

.token.atrule {
  color: var(--code-purple);
}

.token.atrule .token.rule {
  color: var(--code-red);
}

.token.atrule .token.property {
  color: var(--code-aqua);
}

.token.selector {
  color: var(--code-green);
}

.token.operator {
  color: var(--code-aqua);
}

.token.punctuation {
  color: var(--code-fg4);
}

.token.tag {
  color: var(--code-aqua);
}

.token.tag .punctuation {
  color: var(--code-blue);
}

.token.attr-name {
  color: var(--code-yellow);
}

.token.doctype,
.token.class-name-definition,
.token.builtin {
  color: var(--code-yellow);
}

.token.constant,
.token.entity,
.token.number,
.token.symbol {
  color: var(--code-purple);
}

.token.property {
  color: var(--code-orange);
}

.token.variable,
.token.key {
  color: var(--code-blue);
}

.token.string,
.token.char {
  color: var(--code-green);
}

.token.attr-value {
  color: var(--code-green);
}

.token.url {
  color: var(--code-green);
  text-decoration: underline;
}

.token.function {
  color: var(--code-yellow);
}

.token.function-definition {
  color: var(--code-fg);
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}

.language-css .token.function {
  color: var(--code-red);
}

.language-js,
.language-json .token.property {
  color: var(--code-blue);
}

.language-yml {
  color: var(--code-green);
}


  header time {
    font-size: var(--text-sm);
    font-family: var(--font-mono);
  }

  .prose :where(h1, h2, h3, h4, h5, h6),
  .prose figure,
  .prose blockquote,
  .prose table,
  .prose video,
  .prose pre {
    margin-block-start: 1.414em;
  }

  .prose p,
  .prose ul,
  .prose ol,
  .prose dl {
    margin-top: 1em;
  }

  .prose :where(ul, ol)>li+li,
  .prose :where(ul ul, ul ol, ol ul, ol ol),
  .prose :where(ul, ol) p {
    margin-block-start: 1em;
  }

  .prose pre {
    margin-inline: -1rem;
    max-width: calc(100% + 2rem);
  }

  .prose code {
    font-family: var(--font-mono);
    font-size: var(--text-sm);
  }

  .prose figure {
    display: table;
    border: 2px solid var(--black);
  }

  .prose figcaption {
    display: table-caption;
    caption-side: bottom;
    color: var(--primary);
    font-family: var(--font-mono);
    background: var(--black);
    font-size: var(--text-sm);
    padding: .25rem .5rem;
    margin: 0;
  }

  .prose blockquote {
    border-inline-start: 2px solid var(--black);
    padding-inline-start: 1em;
    quotes: "\201C" "\201D" "\2018" "\2019";
  }

  .prose blockquote>cite {
    display: block;
    font-style: italic;
    margin-block-start: 1.125em;
    padding: 0.5em 1.25em;
    background: var(--black);
    color: var(--primary);
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    margin-inline-start: -1.25em;
  }

  .prose> :first-child {
    margin-block-start: 0;
  }

  .prose> :last-child {
    margin-block-end: 0;
  }


.wm_9pyfkg{display:block;margin-block-start:1.171rem}.wm_9pyfkg li>div{display:flex;align-items:center}.wm_9pyfkg img{width:32px;height:32px;border-radius:32px;border:2px solid var(--black);background:var(--black);color:var(--primary);margin-inline-end:.5rem;flex-shrink:0}.wm_9pyfkg h3{font-size:1rem;font-weight:normal}.wm_9pyfkg h3 a:first-child{font-weight:700}
.wnfhxxvce{display:block;position:relative;border-block:2px solid var(--black)}.wnfhxxvce:before{content:"";height:100%;width:2px;background:var(--black);position:absolute;left:50%;top:0;transform:translateX(-50%)}.wnfhxxvce ul{margin:0;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:2rem}.wnfhxxvce li{position:relative}.wnfhxxvce li:last-child{text-align:right}.wnfhxxvce li:last-child span{justify-content:end}.wnfhxxvce li:focus-within{outline:2px solid var(--black);outline-offset:.5rem}.wnfhxxvce span{font-size:var(--text-sm);font-family:var(--font-mono);display:block;margin-block-end:.875em;text-decoration:underline}.wnfhxxvce a{padding:0;font-size:1rem;text-decoration:none;font-weight:700;line-height:1.13}.wnfhxxvce a::before{content:"";position:absolute;inset:.5rem}.wnfhxxvce a:focus,.wnfhxxvce a:hover{outline:none;text-decoration:underline;text-decoration-thickness:1px}

    @font-face {
      font-family: 'General Sans';
      font-style: normal;
      font-weight: 200 700;
      font-display: swap;
      src: local(''), url('../fonts/general-sans/general-sans-variable.woff2') format('woff2');
    }

    @font-face {
      font-family: 'General Sans';
      font-style: italic;
      font-weight: 200 700;
      font-display: swap;
      src: local(''), url('/fonts/general-sans/general-sans-variable-italic.woff2') format('woff2');
    }

    @font-face {
      font-family: 'IBM Plex Mono';
      font-style: normal;
      font-weight: 400;
      font-display: swap;
      src: local(''), url('/fonts/ibm-plex-mono/ibm-plex-mono-400.woff2') format('woff2');
    }

  </style>
  <script></script>
</head>

<body>
  <a href="#main">Skip to content</a>
  <header>
    <nav aria-label="Site" class="center">
      <ul role="list">
        <li><a href="/" aria-current>Home</a></li>
        <li><a href="/words" aria-current>Words</a></li>
        <li><a href="/pictures" aria-current>Pictures</a></li>
        <li>
          <a href="/feed/feed.xml">
            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="16" width="16" style="width:1rem; height:1rem">
              <path fill="currentColor" d="M 4 4.44 v 2.83 c 7.03 0 12.73 5.7 12.73 12.73 h 2.83 c 0 -8.59 -6.97 -15.56 -15.56 -15.56 Z m 0 5.66 v 2.83 c 3.9 0 7.07 3.17 7.07 7.07 h 2.83 c 0 -5.47 -4.43 -9.9 -9.9 -9.9 Z M 6.18 15.64 A 2.18 2.18 0 0 1 6.18 20 A 2.18 2.18 0 0 1 6.18 15.64"></path>
            </svg>
            <span class="sr-only">RSS</span>
          </a>
        </li>
      </ul>
    </nav>
  </header>
  <main id="main">

<article>
  <header>
    <div class="center stack" style="--gap: .5rem">
      <h1>Subdomain Redirects in Laravel Forge</h1>
      <time datetime="2021-02-04">04 Feb 2021</time>
    </div>
  </header>
  <div class="center prose"><p>I had to go through some trial and error to get this working so I'm writing it down. My goal was to permanently redirect a domain like <code>beta.imacrayon.com</code> to <code>imacrayon.com</code> in Laravel Forge.</p>
<p>In order to properly redirect <code>https://beta.imacrayon.com</code>. I generated a new LetsEncrypt certificate with the following domains:</p>
<pre class="language-shell"><code class="language-shell">imacrayon.com,www.imacrayon.com,beta.imacrayon.com</code></pre>
<p>Next I added two new server blocks to the top of my nginx config:</p>
<pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span><br>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span><br>    <span class="token directive"><span class="token keyword">listen</span> [::]:80</span><span class="token punctuation">;</span><br>    <span class="token directive"><span class="token keyword">server_name</span> beta.imacrayon.com</span><span class="token punctuation">;</span><br>    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://imacrayon.com<span class="token variable">$request_uri</span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span><br>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl http2</span><span class="token punctuation">;</span><br>    <span class="token directive"><span class="token keyword">listen</span> [::]:443 ssl http2</span><span class="token punctuation">;</span><br><br>    <span class="token comment"># PASTE YOUR SSL DIRECTIVES HERE</span><br><br>    <span class="token directive"><span class="token keyword">server_name</span> beta.imacrayon.com</span><span class="token punctuation">;</span><br>    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://imacrayon.com<span class="token variable">$request_uri</span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>The second server block requires you to add the SSL directives for the LetsEncrypt certificate generated in the first step. You should be able to find these directives inside your existing nginx config. They’ll probably be labeled with a comment like <code># FORGE SSL (DO NOT REMOVE!)</code> and look like this:</p>
<pre class="language-nginx"><code class="language-nginx">    <span class="token comment"># FORGE SSL (DO NOT REMOVE!)</span><br>    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/nginx/ssl/imacrayon.com/xxx/server.crt</span><span class="token punctuation">;</span><br>    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/nginx/ssl/imacrayon.com/xxx/server.key</span><span class="token punctuation">;</span><br><br>    <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1.2</span><span class="token punctuation">;</span><br>    <span class="token directive"><span class="token keyword">ssl_ciphers</span> ...</span><span class="token punctuation">;</span><br>    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span><br>    <span class="token directive"><span class="token keyword">ssl_dhparam</span> /etc/nginx/dhparams.pem</span><span class="token punctuation">;</span></code></pre>
<p>That’s it! After saving your config <code>http://beta.imacrayon.com</code> and <code>https://beta.imacrayon.com</code> should now redirect to <code>https://imacrayon.com</code>.</p>
<p>Browsers will cache 301 redirects. So when testing these new redirects you may need to enable the “Clear cache” option in your browser's Developer Tools, it’s usually located under the “Network” tab.</p>
</div>
</article>
<pagination class="wnfhxxvce"><nav aria-label="Words" class="center"><ul role="list"><li>
      <a href="/words/adding-cloudflare-to-a-laravel-forge-site/">
        <span>Previous</span>
        Adding Cloudflare to a Laravel Forge&nbsp;Site
      </a>
    </li><li>
      <a href="/words/mlk-day/">
        <span>Next</span>
        MLK&nbsp;Day
      </a>
    </li></ul></nav>


</pagination>
<section aria-labelledby="webmentions">
  <div class="center">
    <h2 id="webmentions">Webmentions</h2>
    <webmentions class="wm_9pyfkg"><p><em>No webmentions posted.</em></p>


</webmentions>
  </div>
</section>


</main>



</body>
</html>